<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1600.2171906521453 1247.203462806829" width="4200.434381304291" height="2494.406925613658">
  <!-- svg-source:excalidraw -->
  
  <defs>
    <style>
      @font-face {
        font-family: "Virgil";
        src: url("https://excalidraw.com/Virgil.woff2");
      }
      @font-face {
        font-family: "Cascadia";
        src: url("https://excalidraw.com/Cascadia.woff2");
      }
    </style>
  </defs>
  <rect x="0" y="0" width="2255.2171906521453" height="1247.203462806829" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(10 222.02461915415216) rotate(0 582.1744255970007 326.2464670596273)"><path d="M-0.3 -0.53 C247.18 -1.63, 492.78 -1.98, 1163.58 -0.24 M-0.07 0.22 C457.7 -3.85, 914.92 -4.09, 1164.1 0.36 M1164.63 -0.78 C1162.45 157.71, 1161.74 314.73, 1164.18 651.85 M1164.63 0.04 C1165.57 241.19, 1165.55 481.53, 1164.74 652.29 M1164.48 652.42 C890.75 650.64, 619.24 651.15, 0.58 652.62 M1164.67 652.22 C804.88 657.21, 445.9 657.42, 0.01 652.26 M-0.53 652.79 C-2.74 500.75, -2.72 350.07, 0.2 0.43 M-0.31 652.21 C0.59 405.14, 0.6 158.3, -0.23 -0.01" stroke="#000000" stroke-width="1" fill="none"></path></g><g stroke-linecap="round" transform="translate(338.9259458478191 140.20752071300066) rotate(0 155.20895224357673 56.327278991697526)"><path d="M-0.95 0.86 C83.9 -0.25, 166.5 -0.54, 309.98 1.33 M0.39 0.12 C78.71 -0.25, 156.47 -0.08, 311.06 -0.42 M308.46 1.41 C311.82 22.8, 310.82 45.91, 308.8 114.04 M310.51 0.58 C310.49 38.6, 309.32 77.16, 309.9 112 M310.29 111.32 C234.75 114.08, 160.89 114.06, 0.23 112.78 M309.93 112.06 C233.87 114.15, 157.55 114.47, -0.41 112.16 M0.75 111.45 C-1.69 67.97, -0.67 26.11, 1.07 1.58 M-0.7 112.06 C-1.01 81.85, -0.12 51.61, -0.03 -0.69" stroke="#000000" stroke-width="1" fill="none"></path></g><g stroke-linecap="round" transform="translate(245.2298085184848 561.322548613434) rotate(0 118.5 36)"><path d="M0.78 -1.26 C62.27 -2.8, 123.92 0.36, 236.19 1.49 M0.62 -0.73 C67.25 -0.85, 134.98 -0.82, 236.21 0.51 M237.72 -0.37 C236.02 23.72, 234.68 49.68, 237.76 70.37 M237.99 0.52 C236.89 27.61, 236.55 52.59, 236.41 71.71 M235.95 73.23 C161.93 71.36, 87.09 70.29, -0.89 73.67 M237.18 71.65 C147.4 70.37, 56.07 69.77, 0.72 72.02 M-1.66 70.83 C-0.92 55.64, 0.8 39.85, -0.63 1.1 M-0.38 71.43 C1 55.32, 0.47 39.12, 0.64 0.8" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(343.9259458478191 184.03479970469817) rotate(0 150 12.5)"><text x="150" y="18" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">api gw</text></g><g transform="translate(250.2298085184848 584.822548613434) rotate(0 113.5 12.5)"><text x="113.5" y="18" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">kratos</text></g><g stroke-linecap="round" transform="translate(21.06084259443378 556.0764112661309) rotate(0 85 39)"><path d="M1.09 0.33 C44.3 -1.44, 85.95 -0.97, 171.8 -1.17 M-0.98 0.7 C35.33 -0.79, 69.79 -0.82, 169.19 0.69 M170.18 1.15 C171.34 27.4, 169.01 54.72, 168.97 76.69 M169.91 -0.93 C169.15 19.52, 169.79 38.3, 170.16 78.08 M168.64 76.33 C128.43 78.54, 87.47 79.42, -1.16 76.63 M170.37 77.4 C103.49 76.3, 38.32 77.13, 0.54 78.79 M-1.4 76.82 C-1.2 55.92, 0.57 34.97, -0.07 -1.37 M0.15 77.67 C-0.41 50.27, -1.38 21.5, 0.86 -0.96" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(26.06084259443378 582.5764112661309) rotate(0 80 12.5)"><text x="80" y="18" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">oathkeeper</text></g><g stroke-linecap="round"><g transform="translate(197.4322861479377 590.8536610633569) rotate(0 21.141732089582092 0.8340045099214421)"><path d="M0.89 -1.04 C7.85 -0.81, 35.32 1.12, 42.38 1.56 M-0.1 1.03 C6.66 1.38, 34.34 2.45, 41.54 2.71" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(197.4322861479377 590.8536610633569) rotate(0 21.141732089582092 0.8340045099214421)"><path d="M19.7 9.51 C27.29 8.53, 34.5 2.55, 42.74 3.41 M21.24 9.04 C25.23 6.99, 30.2 6.87, 40.72 3.4" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(197.4322861479377 590.8536610633569) rotate(0 21.141732089582092 0.8340045099214421)"><path d="M20.24 -4.93 C27.67 -0.78, 34.68 -1.64, 42.74 3.41 M21.79 -5.4 C25.77 -4.53, 30.62 -1.73, 40.72 3.4" stroke="#000000" stroke-width="1" fill="none"></path></g></g><g stroke-linecap="round" transform="translate(656.3565567312098 548.9787427753367) rotate(0 105.5 102.72166570683959)"><path d="M1.58 -1.04 C43.37 2.23, 90.7 -0.56, 212.24 0.64 M-0.71 0.61 C59.75 -0.32, 119.44 0.48, 211.51 0.87 M210.08 -1.17 C209.62 71.74, 210.97 144.36, 209.34 204.33 M211.14 0.08 C210.55 77.63, 211.74 152.87, 210.26 205.64 M209.98 204.24 C158.01 205.53, 100.82 206.15, -1.07 203.98 M211.47 206.14 C159.71 206.4, 108.31 205.3, -0.52 205.1 M-0.06 204.22 C0.22 157.02, -0.32 106.03, -0.59 0.38 M0.77 204.59 C2.21 131.19, 0.92 56.37, -0.35 0.18" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(661.3565567312098 639.2004084821763) rotate(0 100.5 12.5)"><text x="100.5" y="18" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">user-service</text></g><g stroke-linecap="round" transform="translate(936.7967722887834 481.9457313758441) rotate(0 105.5 102.72166570683959)"><path d="M1.07 0.62 C80.52 3, 165.13 1.43, 210.75 -0.38 M-0.72 0.61 C46.36 -0.2, 93.43 -0.25, 210.84 0.87 M210.48 0.3 C209.64 49.38, 208.68 103.39, 211.02 206.73 M211.89 0.72 C210.55 64.23, 211.35 129.57, 211.66 205.47 M211.04 204.28 C160.56 205.98, 107.34 206.02, -0.57 205.89 M211.49 204.77 C135.77 204.33, 61.43 204.35, 0.44 204.93 M1.42 206.04 C1.53 143.9, 1.63 84.69, -1.35 0.44 M0.66 204.98 C2.51 125.79, 1.94 46.28, -0.35 0.64" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(941.7967722887834 572.1673970826837) rotate(0 100.5 12.5)"><text x="100.5" y="18" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">mood-diary</text></g><g transform="translate(142.93528696926114 10) rotate(0 258 22.5)"><text x="0" y="32" font-family="Virgil, Segoe UI Emoji" font-size="36px" fill="#2b8a3e" text-anchor="start" style="white-space: pre;" direction="ltr">Better Architecture Diagram</text></g><g stroke-linecap="round" transform="translate(50.90874398486267 354.36393982842316) rotate(0 195.60870221131154 57.802601248134636)"><path d="M-0.55 -0.51 C127.1 2.28, 253.68 3.09, 390.9 -0.97 M-0.26 -0.29 C82.54 -0.8, 164.64 -0.65, 391.5 0.16 M391.31 0.03 C388.34 25.57, 391.02 48.68, 390.9 114.21 M392.06 -0.3 C391.73 28.18, 392.71 56.66, 390.81 115.52 M392.05 115.96 C251.16 116.58, 110.82 117.16, -1.15 116.22 M390.98 115.25 C249.14 113.42, 108.32 114.11, -0.45 115.5 M0.53 116.62 C2.74 71.81, 1.24 29.5, 1.97 0.12 M0.26 116.51 C-0.5 72.59, -0.5 29.03, 0.27 -0.59" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(55.90874398486267 388.66654107655773) rotate(0 190.5 23)"><text x="190.5" y="17" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">boingboing | Yamas</text><text x="190.5" y="40" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="middle" style="white-space: pre;" direction="ltr">(a FULL auth service)</text></g><g stroke-linecap="round"><g transform="translate(322.58442670751447 240.55403343110277) rotate(0 -47.15941740494327 47.816863881007464)"><path d="M0.51 0.22 C-15.25 16.1, -78.17 79.33, -93.77 95.19 M-0.68 -0.72 C-16.69 15.31, -79.35 80.16, -94.83 96.35" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(322.58442670751447 240.55403343110277) rotate(0 -47.15941740494327 47.816863881007464)"><path d="M-82.31 68.57 C-88.39 79.9, -92.55 90.73, -94.78 97.25 M-83.25 69.43 C-86.34 78.01, -89.23 85.68, -94.82 95.42" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(322.58442670751447 240.55403343110277) rotate(0 -47.15941740494327 47.816863881007464)"><path d="M-67.53 82.8 C-79.06 88.94, -88.67 94.52, -94.78 97.25 M-68.47 83.66 C-76.25 87.93, -83.71 91.21, -94.82 95.42" stroke="#000000" stroke-width="1" fill="none"></path></g></g><g stroke-linecap="round"><g transform="translate(354.2410065016729 488.85368525215114) rotate(0 -0.8925797088299987 30.84277950434347)"><path d="M0.23 0.39 C0.2 10.59, -0.89 50.88, -0.87 61.18 M-1.11 -0.45 C-1.27 9.86, -2.17 51.49, -1.99 62.14" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(354.2410065016729 488.85368525215114) rotate(0 -0.8925797088299987 30.84277950434347)"><path d="M-11.46 33.36 C-11.51 42.17, -7.37 48.54, -2.43 61.9 M-12.61 34.31 C-9.3 43.68, -5.81 54.45, -1.26 62.35" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(354.2410065016729 488.85368525215114) rotate(0 -0.8925797088299987 30.84277950434347)"><path d="M9.06 33.46 C4.03 42.29, 3.17 48.63, -2.43 61.9 M7.91 34.41 C4.08 43.6, 0.43 54.33, -1.26 62.35" stroke="#000000" stroke-width="1" fill="none"></path></g></g><g stroke-linecap="round"><g transform="translate(143.90782428925922 487.5671066471553) rotate(0 0.8047320280852546 26.667305464828473)"><path d="M-0.25 0.06 C0.01 9.29, 0.77 45.27, 0.71 54.29 M1.82 -0.95 C2.08 8.01, 0.87 43.62, 0.31 52.44" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(143.90782428925922 487.5671066471553) rotate(0 0.8047320280852546 26.667305464828473)"><path d="M-7.63 28.55 C-5.19 32.33, -3.56 39.22, 1.34 50.75 M-7.61 27.69 C-4.69 34.17, -3.57 39.5, 0.23 51.57" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(143.90782428925922 487.5671066471553) rotate(0 0.8047320280852546 26.667305464828473)"><path d="M10.74 29.38 C8.91 32.93, 6.27 39.62, 1.34 50.75 M10.76 28.52 C9.06 34.69, 5.58 39.81, 0.23 51.57" stroke="#000000" stroke-width="1" fill="none"></path></g></g><g stroke-linecap="round"><g transform="translate(262.50048988138224 341.003156624829) rotate(0 42.141538977734854 -39.04095172948419)"><path d="M1.03 0.52 C14.92 -12.2, 70.1 -63.86, 84.18 -76.74 M0.1 -0.26 C13.75 -13.3, 68.92 -65.51, 83.13 -78.6" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(262.50048988138224 341.003156624829) rotate(0 42.141538977734854 -39.04095172948419)"><path d="M70.42 -52.17 C75.48 -59.93, 80.48 -70.67, 81.25 -79.75 M70.32 -52.42 C75.02 -60.8, 79.74 -72.38, 83.87 -77.68" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(262.50048988138224 341.003156624829) rotate(0 42.141538977734854 -39.04095172948419)"><path d="M56.4 -67.16 C66.57 -69.52, 76.72 -74.75, 81.25 -79.75 M56.3 -67.4 C66.17 -70.28, 76.08 -76.32, 83.87 -77.68" stroke="#000000" stroke-width="1" fill="none"></path></g></g><g stroke-linecap="round"><g transform="translate(575.200156796469 262.93577411293205) rotate(0 78.75474628112352 131.95007507024934)"><path d="M0.83 -0.01 C26.89 44.08, 129.58 221, 155.6 264.96 M-0.19 -1.06 C26.28 42.67, 131.63 218.99, 157.7 263.33" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(575.200156796469 262.93577411293205) rotate(0 78.75474628112352 131.95007507024934)"><path d="M134.47 242.39 C141.61 248.97, 145.16 254.91, 159.53 264.67 M133.94 244.01 C142.1 251.95, 150.82 258.04, 157.73 263.94" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(575.200156796469 262.93577411293205) rotate(0 78.75474628112352 131.95007507024934)"><path d="M152.12 231.91 C155.1 241.1, 154.47 249.53, 159.53 264.67 M151.59 233.54 C153.35 245.12, 155.66 255.02, 157.73 263.94" stroke="#000000" stroke-width="1" fill="none"></path></g></g><g stroke-linecap="round"><g transform="translate(660.2798944020105 263.3233270393978) rotate(0 130.53423928666552 98.16745039282463)"><path d="M-0.17 0.65 C43.09 33.19, 216.97 163.79, 260.42 196.38 M-1.71 -0.05 C41.86 32.64, 219.26 162.2, 262.78 194.56" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(660.2798944020105 263.3233270393978) rotate(0 130.53423928666552 98.16745039282463)"><path d="M235.08 185.01 C245.72 188.34, 256.14 192.27, 261.2 196.27 M233.74 186.35 C244.07 188.81, 254.53 191.78, 262.14 194.7" stroke="#000000" stroke-width="1" fill="none"></path></g><g transform="translate(660.2798944020105 263.3233270393978) rotate(0 130.53423928666552 98.16745039282463)"><path d="M247.25 168.48 C253.52 177.94, 259.41 188.02, 261.2 196.27 M245.9 169.82 C251.84 178.46, 257.81 187.52, 262.14 194.7" stroke="#000000" stroke-width="1" fill="none"></path></g></g><g transform="translate(11.217190652145291 887.2034628068291) rotate(0 1117 175)"><text x="0" y="25" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr">Dreamt about this last night so I'll leave it here as food for thought:</text><text x="0" y="60" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr">- Boingboing (or whatever other stupid name we can come up with) now sits in front of Kratos and Oathkeeper</text><text x="0" y="95" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr">- That way it can easily intercept calls, as well as do the userID matching, without Oathkeeper having to go back and forth with another servioce</text><text x="0" y="130" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr">- During registration it generates new credentials just like bouncer and already starts generating UserIDs for each service</text><text x="0" y="165" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr">- During loginin/logout it directly proxies to Kratos</text><text x="0" y="200" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr">- For all other API calls it performs authentication check with Oathkeeper and then automatically injects the appropriate headers with UserID</text><text x="0" y="235" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr">- This means Oathkeeper will not have to perform another roundtrip to what is Koda right now</text><text x="0" y="270" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr">- It also simplifies the structure and all Auth flows by reducing components</text><text x="0" y="305" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr"></text><text x="0" y="340" font-family="Virgil, Segoe UI Emoji" font-size="28px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr">This is probably not something we will do this semester, but maybe we can think a bit more about this and put it into the "future work" section of the report :)</text></g></svg>